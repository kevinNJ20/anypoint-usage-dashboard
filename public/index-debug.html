<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Debug</title>
    <style>
        body {
            background: #1a1a1a;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .debug-info {
            background: #333;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: green; }
        .error { background: red; }
        .warning { background: orange; }
    </style>
</head>
<body>
    <h1>üîç Mode Debug - Dashboard</h1>
    
    <div class="debug-info">
        <h2>√âtat du syst√®me</h2>
        <div id="status"></div>
    </div>

    <div class="debug-info">
        <h2>Test de l'API Mulesoft</h2>
        <button onclick="testAPI()">Tester la connexion API</button>
        <div id="api-result"></div>
    </div>

    <div class="debug-info">
        <h2>Chargement des biblioth√®ques</h2>
        <div id="libs-status"></div>
    </div>

    <div class="debug-info">
        <h2>Lancer le Dashboard complet</h2>
        <button onclick="window.location.href='/index.html'">Aller au Dashboard</button>
    </div>

    <script>
        // Test de base
        document.getElementById('status').innerHTML = `
            <div class="status success">‚úÖ Page HTML charg√©e</div>
            <div class="status success">‚úÖ JavaScript actif</div>
            <div class="status success">‚úÖ CSS appliqu√©</div>
        `;

        // Test des biblioth√®ques
        function checkLibraries() {
            let libsHTML = '';
            
            // Test React
            if (typeof React !== 'undefined') {
                libsHTML += '<div class="status success">‚úÖ React charg√©</div>';
            } else {
                libsHTML += '<div class="status error">‚ùå React non charg√©</div>';
            }
            
            // Test ReactDOM
            if (typeof ReactDOM !== 'undefined') {
                libsHTML += '<div class="status success">‚úÖ ReactDOM charg√©</div>';
            } else {
                libsHTML += '<div class="status error">‚ùå ReactDOM non charg√©</div>';
            }
            
            // Test Recharts
            if (typeof Recharts !== 'undefined') {
                libsHTML += '<div class="status success">‚úÖ Recharts charg√©</div>';
            } else {
                libsHTML += '<div class="status warning">‚ö†Ô∏è Recharts non charg√© (chargement peut prendre du temps)</div>';
            }
            
            document.getElementById('libs-status').innerHTML = libsHTML;
        }

        // Test de l'API
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<div class="status warning">‚è≥ Test en cours...</div>';
            
            try {
                // Test du serveur Node.js
                const response = await fetch('/health');
                const data = await response.json();
                
                resultDiv.innerHTML = `
                    <div class="status success">‚úÖ Serveur Node.js: OK</div>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
                
                // Test de l'API Mulesoft
                try {
                    const muleResponse = await fetch('http://localhost:8081/api/meters');
                    if (muleResponse.ok) {
                        resultDiv.innerHTML += '<div class="status success">‚úÖ API Mulesoft: Accessible</div>';
                    } else {
                        resultDiv.innerHTML += '<div class="status warning">‚ö†Ô∏è API Mulesoft: Status ' + muleResponse.status + '</div>';
                    }
                } catch (muleError) {
                    resultDiv.innerHTML += `<div class="status error">‚ùå API Mulesoft: Non accessible (Assurez-vous qu'elle est d√©marr√©e sur le port 8081)</div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="status error">‚ùå Erreur: ${error.message}</div>
                `;
            }
        }

        // Charger les biblioth√®ques externes pour le test
        function loadExternalLibraries() {
            // React
            const reactScript = document.createElement('script');
            reactScript.src = 'https://unpkg.com/react@18/umd/react.production.min.js';
            reactScript.onload = () => checkLibraries();
            document.head.appendChild(reactScript);
            
            // ReactDOM
            const reactDOMScript = document.createElement('script');
            reactDOMScript.src = 'https://unpkg.com/react-dom@18/umd/react-dom.production.min.js';
            reactDOMScript.onload = () => checkLibraries();
            document.head.appendChild(reactDOMScript);
            
            // Recharts
            const rechartsScript = document.createElement('script');
            rechartsScript.src = 'https://cdn.jsdelivr.net/npm/recharts@2.5.0/dist/Recharts.js';
            rechartsScript.onload = () => checkLibraries();
            document.head.appendChild(rechartsScript);
        }

        // Initialisation
        window.onload = () => {
            loadExternalLibraries();
            setTimeout(checkLibraries, 2000);
        };

        // Log console
        console.log('üîç Page de debug charg√©e');
        console.log('üìç URL actuelle:', window.location.href);
        console.log('üåê Navigator:', navigator.userAgent);
    </script>
</body>
</html>